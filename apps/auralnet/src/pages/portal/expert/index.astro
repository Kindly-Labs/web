---
import PortalLayout from '../../../layouts/PortalLayout.astro';
import { DIALECTS, TOPICS, getAvailableTasks, PHRASES } from '../../../data/portal-data';

// Get expert's assigned dialect (for demo, using Toishanese)
const assignedDialect = DIALECTS.find(d => d.id === 'toishanese-001');
const availableTasks = getAvailableTasks('toishanese-001');

// Mock expert stats
const stats = {
    completedTasks: 12,
    pendingTasks: availableTasks.length,
    accuracy: 94,
    earnings: 47.50,
    pendingPayment: 8.50
};
---

<PortalLayout title="Owly Portal | Expert Dashboard" activeNav="expert-home">
    
    <!-- Welcome Banner -->
    <div class="glass-panel p-6 mb-8 bg-gradient-to-r from-green-500/10 to-transparent">
        <h2 class="text-xl font-bold text-foreground mb-1">ğŸ“ Expert Dashboard</h2>
        <p class="text-sm text-muted-foreground">Complete tasks to help preserve dialects and earn money.</p>
    </div>

    <!-- Stats Overview -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
        <div class="glass-panel p-6">
            <dt class="text-xs font-medium text-muted-foreground uppercase tracking-wider">Completed Tasks</dt>
            <dd class="mt-2 text-3xl font-bold text-foreground">{stats.completedTasks}</dd>
        </div>
        <div class="glass-panel p-6">
            <dt class="text-xs font-medium text-muted-foreground uppercase tracking-wider">Available Tasks</dt>
            <dd class="mt-2 text-3xl font-bold text-primary">{stats.pendingTasks}</dd>
        </div>
        <div class="glass-panel p-6">
            <dt class="text-xs font-medium text-muted-foreground uppercase tracking-wider">Accuracy Score</dt>
            <dd class="mt-2 text-3xl font-bold text-green-400">{stats.accuracy}%</dd>
        </div>
        <div class="glass-panel p-6">
            <dt class="text-xs font-medium text-muted-foreground uppercase tracking-wider">Total Earnings</dt>
            <dd class="mt-2 text-3xl font-bold text-foreground">${stats.earnings.toFixed(2)}</dd>
            <p class="text-xs text-muted-foreground mt-1">+${stats.pendingPayment.toFixed(2)} pending</p>
        </div>
    </div>

    <!-- Available Tasks Preview -->
    <div class="glass-panel overflow-hidden mb-8">
        <div class="px-6 py-4 border-b border-white/10 flex justify-between items-center">
            <h2 class="text-lg font-bold text-foreground">Available Tasks</h2>
            <a href="/portal/expert/tasks" class="text-primary text-sm hover:underline">View all â†’</a>
        </div>
        <div class="divide-y divide-white/5">
            {availableTasks.slice(0, 4).map((phrase) => {
                const topic = TOPICS.find(t => t.id === phrase.topicId);
                return (
                    <div class="px-6 py-4 flex items-center justify-between hover:bg-white/5 transition-colors cursor-pointer group">
                        <div class="flex items-center gap-4">
                            <div class="w-10 h-10 rounded-xl bg-primary/20 flex items-center justify-center">
                                <span class="text-lg">ğŸ¤</span>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-foreground">{phrase.text}</p>
                                <p class="text-xs text-muted-foreground">{phrase.englishHint} â€¢ {topic?.name || 'Unknown'}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="text-sm font-medium text-green-400">${phrase.paymentPerTask.toFixed(2)}</span>
                            <button class="btn-accent text-xs px-4 py-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                Start
                            </button>
                        </div>
                    </div>
                );
            })}
        </div>
    </div>

    <!-- Quick Actions -->
    <h2 class="text-lg font-bold text-foreground mb-4">Quick Actions</h2>
    <div class="grid md:grid-cols-3 gap-4">
        <a href="/portal/expert/tasks" class="glass-panel p-6 text-left hover:bg-white/10 transition-colors group">
            <div class="text-2xl mb-3">ğŸ¤</div>
            <h3 class="font-bold text-foreground mb-1 group-hover:text-primary transition-colors">Record New Phrase</h3>
            <p class="text-xs text-muted-foreground">Speak dialect phrases clearly</p>
        </a>
        <a href="/portal/expert/tasks?type=transcribe" class="glass-panel p-6 text-left hover:bg-white/10 transition-colors group">
            <div class="text-2xl mb-3">âœï¸</div>
            <h3 class="font-bold text-foreground mb-1 group-hover:text-primary transition-colors">Transcribe Audio</h3>
            <p class="text-xs text-muted-foreground">Add text for recordings</p>
        </a>
        <a href="/portal/expert/tasks?type=validate" class="glass-panel p-6 text-left hover:bg-white/10 transition-colors group">
            <div class="text-2xl mb-3">âœ“</div>
            <h3 class="font-bold text-foreground mb-1 group-hover:text-primary transition-colors">Validate Labels</h3>
            <p class="text-xs text-muted-foreground">Review other contributions</p>
        </a>
    </div>

</PortalLayout>
